'use client'

import { useEffect, useState } from 'react'
import { CheckCircle, Star, Trophy, Heart, Zap, Sparkles, Award, Crown } from 'lucide-react'

interface ConfettiEffectProps {
  isActive: boolean
  onComplete: () => void
  selectedSupporter?: Supporter | null
}

type ParticleType = 'confetti' | 'star' | 'trophy' | 'heart' | 'zap' | 'sparkles' | 'award' | 'crown' | 'firework' | 'lightning' | 'rainbow'
type PatternType = 'normal' | 'spiral' | 'explosion' | 'rain' | 'starfield'

interface Supporter {
  id: string
  name: string
  avatar: string
  messages: string[]
  color: string
  customName?: string
}

export default function ConfettiEffect({ isActive, onComplete, selectedSupporter }: ConfettiEffectProps) {
  const [particles, setParticles] = useState<Array<{
    id: number
    x: number
    y: number
    vx: number
    vy: number
    rotation: number
    rotationSpeed: number
    color: string
    type: ParticleType
    scale: number
    trail: Array<{x: number, y: number, opacity: number}>
    neon: boolean
  }>>([])
  
  const [currentMessage, setCurrentMessage] = useState<string>('')
  const [currentPattern, setCurrentPattern] = useState<PatternType>('normal')
  const [currentSupporter, setCurrentSupporter] = useState<Supporter | null>(null)
  const [showFlash, setShowFlash] = useState(false)

  // ÂøúÊè¥ËÄÖ„ÅÆÂÆöÁæ©Ôºà30ÂÄã„Åö„Å§„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏Ôºâ
  const supporters: Supporter[] = [
    {
      id: 'family',
      name: 'ÂÆ∂Êóè',
      avatar: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
      color: '#FF6B9D',
      messages: [
        "‰ªäÊó•„ÅÆ‰ªï‰∫ã„Å∂„Çä„ÅØÊàêÈï∑„ÇíÊÑü„Åò„Çã„Å™ÔºÅÁ¢∫ÂÆü„Å´„Çπ„ÉÜ„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åó„Å¶„Çã„ÅûÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Çà„ÅèÈ†ëÂºµ„Å£„Åü„Å™ÔºÅ„É™„Éº„ÉÄ„Éº„Ç∑„ÉÉ„Éó„ÅåÂÖâ„Å£„Å¶„Åü„ÅûÔºÅ",
        "„Åì„ÅÆÊàêÊûú„ÅØÁ¥†Êô¥„Çâ„Åó„ÅÑÔºÅÂêõ„ÅÆÂä™Âäõ„ÅåÂÆü„ÇíÁµê„Çì„Åß„ÇãÔºÅ",
        "ÊØéÊó•ÁùÄÂÆü„Å´ÊàêÈï∑„Åó„Å¶„Çã„Å™ÔºÅÂÆ∂Êóè„ÅÆË™á„Çä„Å†„ÅûÔºÅ",
        "‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØÂÆå‰∫Ü„ÅØÂÆåÁíß„Å†ÔºÅÂêõ„ÅÆÈõÜ‰∏≠Âäõ„Åå„Åô„Åî„ÅÑÔºÅ",
        "„Åì„ÅÆ‰ªï‰∫ã„Å∂„Çä„ÇíË¶ã„Å¶„Çã„Å®„ÄÅÂêõ„ÅÆÊàêÈï∑„ÅåÊâã„Å´Âèñ„Çã„Çà„ÅÜ„Å´ÂàÜ„Åã„ÇãÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Åß„ÅÆÁô∫Ë®Ä„ÄÅ„Å®„Å¶„ÇÇËâØ„Åã„Å£„ÅüÔºÅËá™‰ø°„ÇíÊåÅ„Å£„Å¶Ë©±„Åó„Å¶„ÅüÔºÅ",
        "‰ªäÊó•„ÇÇÈ†ëÂºµ„Å£„Åü„Å™ÔºÅÂêõ„ÅÆÁ≤ò„ÇäÂº∑„Åï„ÅåÂÖâ„Å£„Å¶„ÇãÔºÅ",
        "„Åì„ÅÆÊàêÊûú„ÅØÂêõ„ÅÆÂÆüÂäõ„ÅÆË®ºÊòé„Å†ÔºÅÁùÄÂÆü„Å´ÊàêÈï∑„Åó„Å¶„Çã„ÅûÔºÅ",
        "ÊØéÊó•„ÅÆÁ©ç„ÅøÈáç„Å≠„ÅåÂÆü„ÇíÁµê„Çì„Åß„ÇãÔºÅÂêõ„ÅÆÂä™Âäõ„ÅØÁÑ°ÈßÑ„Å´„Å™„Å£„Å¶„Å™„ÅÑÔºÅ",
        "‰ªäÊó•„ÅÆ‰ªï‰∫ã„ÅØÁ¥†Êô¥„Çâ„Åó„Åã„Å£„ÅüÔºÅÂêõ„ÅÆÊàêÈï∑„ÅåÁõÆ„Å´Ë¶ã„Åà„ÇãÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Åß„ÅÆÈÄ≤Ë°å„ÄÅ„Å®„Å¶„ÇÇ‰∏äÊâã„Å†„Å£„ÅüÔºÅ„É™„Éº„ÉÄ„Éº„Ç∑„ÉÉ„Éó„ÅåÂÖâ„Å£„Å¶„ÇãÔºÅ",
        "„Åì„ÅÆ„Çø„Çπ„ÇØÂÆå‰∫Ü„ÅØÂÆåÁíß„Å†ÔºÅÂêõ„ÅÆÈõÜ‰∏≠Âäõ„Å®ÂÆüË°åÂäõ„Åå„Åô„Åî„ÅÑÔºÅ",
        "ÊØéÊó•ÁùÄÂÆü„Å´ÈÄ≤Ê≠©„Åó„Å¶„Çã„Å™ÔºÅÂêõ„ÅÆÊàêÈï∑„ÅØÊ≠¢„Åæ„Çâ„Å™„ÅÑÔºÅ",
        "‰ªäÊó•„ÅÆÊàêÊûú„ÅØÂêõ„ÅÆÂÆüÂäõ„ÅÆË®º„Å†ÔºÅÁ¢∫ÂÆü„Å´„Çπ„ÉÜ„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åó„Å¶„ÇãÔºÅ",
        "„Åì„ÅÆ‰ªï‰∫ã„Å∂„Çä„ÇíË¶ã„Å¶„Çã„Å®„ÄÅÂêõ„ÅÆÂ∞ÜÊù•„ÅåÊ•Ω„Åó„Åø„Å´„Å™„ÇãÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Åß„ÅÆÊÑèË¶ã„ÄÅ„Å®„Å¶„ÇÇÁöÑÁ¢∫„Å†„Å£„ÅüÔºÅÊàêÈï∑„ÇíÊÑü„Åò„ÇãÔºÅ",
        "‰ªäÊó•„ÇÇÈ†ëÂºµ„Å£„Åü„Å™ÔºÅÂêõ„ÅÆÂä™Âäõ„ÅØÂøÖ„ÅöÂ†±„Çè„Çå„ÇãÔºÅ",
        "„Åì„ÅÆÊàêÊûú„ÅØÂêõ„ÅÆÂÆüÂäõ„ÅÆË®ºÊòé„Å†ÔºÅÁùÄÂÆü„Å´ÊàêÈï∑„Åó„Å¶„Çã„ÅûÔºÅ",
        "ÊØéÊó•„ÅÆÁ©ç„ÅøÈáç„Å≠„ÅåÂÆü„ÇíÁµê„Çì„Åß„ÇãÔºÅÂêõ„ÅÆÂä™Âäõ„ÅØÁÑ°ÈßÑ„Å´„Å™„Å£„Å¶„Å™„ÅÑÔºÅ",
        "‰ªäÊó•„ÅÆ‰ªï‰∫ã„ÅØÁ¥†Êô¥„Çâ„Åó„Åã„Å£„ÅüÔºÅÂêõ„ÅÆÊàêÈï∑„ÅåÁõÆ„Å´Ë¶ã„Åà„ÇãÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Åß„ÅÆÈÄ≤Ë°å„ÄÅ„Å®„Å¶„ÇÇ‰∏äÊâã„Å†„Å£„ÅüÔºÅ„É™„Éº„ÉÄ„Éº„Ç∑„ÉÉ„Éó„ÅåÂÖâ„Å£„Å¶„ÇãÔºÅ",
        "„Åì„ÅÆ„Çø„Çπ„ÇØÂÆå‰∫Ü„ÅØÂÆåÁíß„Å†ÔºÅÂêõ„ÅÆÈõÜ‰∏≠Âäõ„Å®ÂÆüË°åÂäõ„Åå„Åô„Åî„ÅÑÔºÅ",
        "ÊØéÊó•ÁùÄÂÆü„Å´ÈÄ≤Ê≠©„Åó„Å¶„Çã„Å™ÔºÅÂêõ„ÅÆÊàêÈï∑„ÅØÊ≠¢„Åæ„Çâ„Å™„ÅÑÔºÅ",
        "‰ªäÊó•„ÅÆÊàêÊûú„ÅØÂêõ„ÅÆÂÆüÂäõ„ÅÆË®º„Å†ÔºÅÁ¢∫ÂÆü„Å´„Çπ„ÉÜ„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åó„Å¶„ÇãÔºÅ",
        "„Åì„ÅÆ‰ªï‰∫ã„Å∂„Çä„ÇíË¶ã„Å¶„Çã„Å®„ÄÅÂêõ„ÅÆÂ∞ÜÊù•„ÅåÊ•Ω„Åó„Åø„Å´„Å™„ÇãÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Åß„ÅÆÊÑèË¶ã„ÄÅ„Å®„Å¶„ÇÇÁöÑÁ¢∫„Å†„Å£„ÅüÔºÅÊàêÈï∑„ÇíÊÑü„Åò„ÇãÔºÅ",
        "‰ªäÊó•„ÇÇÈ†ëÂºµ„Å£„Åü„Å™ÔºÅÂêõ„ÅÆÂä™Âäõ„ÅØÂøÖ„ÅöÂ†±„Çè„Çå„ÇãÔºÅ",
        "„Åì„ÅÆÊàêÊûú„ÅØÂêõ„ÅÆÂÆüÂäõ„ÅÆË®ºÊòé„Å†ÔºÅÁùÄÂÆü„Å´ÊàêÈï∑„Åó„Å¶„Çã„ÅûÔºÅ",
        "ÊØéÊó•„ÅÆÁ©ç„ÅøÈáç„Å≠„ÅåÂÆü„ÇíÁµê„Çì„Åß„ÇãÔºÅÂêõ„ÅÆÂä™Âäõ„ÅØÁÑ°ÈßÑ„Å´„Å™„Å£„Å¶„Å™„ÅÑÔºÅ",
        "‰ªäÊó•„ÅÆ‰ªï‰∫ã„ÅØÁ¥†Êô¥„Çâ„Åó„Åã„Å£„ÅüÔºÅÂêõ„ÅÆÊàêÈï∑„ÅåÁõÆ„Å´Ë¶ã„Åà„ÇãÔºÅ"
      ]
    },
    {
      id: 'friend',
      name: 'ÂèãÈÅî',
      avatar: 'üë•',
      color: '#4ECDC4',
      messages: [
        "‰ªäÊó•„ÅÆ‰ªï‰∫ã„Å∂„Çä„ÅØÊàêÈï∑„ÇíÊÑü„Åò„Çã„Å™ÔºÅÁ¢∫ÂÆü„Å´„Çπ„ÉÜ„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åó„Å¶„Çã„ÅûÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Çà„ÅèÈ†ëÂºµ„Å£„Åü„Å™ÔºÅ„É™„Éº„ÉÄ„Éº„Ç∑„ÉÉ„Éó„ÅåÂÖâ„Å£„Å¶„Åü„ÅûÔºÅ",
        "„Åì„ÅÆÊàêÊûú„ÅØÁ¥†Êô¥„Çâ„Åó„ÅÑÔºÅÂêõ„ÅÆÂä™Âäõ„ÅåÂÆü„ÇíÁµê„Çì„Åß„ÇãÔºÅ",
        "ÊØéÊó•ÁùÄÂÆü„Å´ÊàêÈï∑„Åó„Å¶„Çã„Å™ÔºÅÂèãÈÅî„Å®„Åó„Å¶Ë™á„Çä„Å†„ÅûÔºÅ",
        "‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØÂÆå‰∫Ü„ÅØÂÆåÁíß„Å†ÔºÅÂêõ„ÅÆÈõÜ‰∏≠Âäõ„Åå„Åô„Åî„ÅÑÔºÅ",
        "„Åì„ÅÆ‰ªï‰∫ã„Å∂„Çä„ÇíË¶ã„Å¶„Çã„Å®„ÄÅÂêõ„ÅÆÊàêÈï∑„ÅåÊâã„Å´Âèñ„Çã„Çà„ÅÜ„Å´ÂàÜ„Åã„ÇãÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Åß„ÅÆÁô∫Ë®Ä„ÄÅ„Å®„Å¶„ÇÇËâØ„Åã„Å£„ÅüÔºÅËá™‰ø°„ÇíÊåÅ„Å£„Å¶Ë©±„Åó„Å¶„ÅüÔºÅ",
        "‰ªäÊó•„ÇÇÈ†ëÂºµ„Å£„Åü„Å™ÔºÅÂêõ„ÅÆÁ≤ò„ÇäÂº∑„Åï„ÅåÂÖâ„Å£„Å¶„ÇãÔºÅ",
        "„Åì„ÅÆÊàêÊûú„ÅØÂêõ„ÅÆÂÆüÂäõ„ÅÆË®ºÊòé„Å†ÔºÅÁùÄÂÆü„Å´ÊàêÈï∑„Åó„Å¶„Çã„ÅûÔºÅ",
        "ÊØéÊó•„ÅÆÁ©ç„ÅøÈáç„Å≠„ÅåÂÆü„ÇíÁµê„Çì„Åß„ÇãÔºÅÂêõ„ÅÆÂä™Âäõ„ÅØÁÑ°ÈßÑ„Å´„Å™„Å£„Å¶„Å™„ÅÑÔºÅ",
        "‰ªäÊó•„ÅÆ‰ªï‰∫ã„ÅØÁ¥†Êô¥„Çâ„Åó„Åã„Å£„ÅüÔºÅÂêõ„ÅÆÊàêÈï∑„ÅåÁõÆ„Å´Ë¶ã„Åà„ÇãÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Åß„ÅÆÈÄ≤Ë°å„ÄÅ„Å®„Å¶„ÇÇ‰∏äÊâã„Å†„Å£„ÅüÔºÅ„É™„Éº„ÉÄ„Éº„Ç∑„ÉÉ„Éó„ÅåÂÖâ„Å£„Å¶„ÇãÔºÅ",
        "„Åì„ÅÆ„Çø„Çπ„ÇØÂÆå‰∫Ü„ÅØÂÆåÁíß„Å†ÔºÅÂêõ„ÅÆÈõÜ‰∏≠Âäõ„Å®ÂÆüË°åÂäõ„Åå„Åô„Åî„ÅÑÔºÅ",
        "ÊØéÊó•ÁùÄÂÆü„Å´ÈÄ≤Ê≠©„Åó„Å¶„Çã„Å™ÔºÅÂêõ„ÅÆÊàêÈï∑„ÅØÊ≠¢„Åæ„Çâ„Å™„ÅÑÔºÅ",
        "‰ªäÊó•„ÅÆÊàêÊûú„ÅØÂêõ„ÅÆÂÆüÂäõ„ÅÆË®º„Å†ÔºÅÁ¢∫ÂÆü„Å´„Çπ„ÉÜ„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åó„Å¶„ÇãÔºÅ",
        "„Åì„ÅÆ‰ªï‰∫ã„Å∂„Çä„ÇíË¶ã„Å¶„Çã„Å®„ÄÅÂêõ„ÅÆÂ∞ÜÊù•„ÅåÊ•Ω„Åó„Åø„Å´„Å™„ÇãÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Åß„ÅÆÊÑèË¶ã„ÄÅ„Å®„Å¶„ÇÇÁöÑÁ¢∫„Å†„Å£„ÅüÔºÅÊàêÈï∑„ÇíÊÑü„Åò„ÇãÔºÅ",
        "‰ªäÊó•„ÇÇÈ†ëÂºµ„Å£„Åü„Å™ÔºÅÂêõ„ÅÆÂä™Âäõ„ÅØÂøÖ„ÅöÂ†±„Çè„Çå„ÇãÔºÅ",
        "„Åì„ÅÆÊàêÊûú„ÅØÂêõ„ÅÆÂÆüÂäõ„ÅÆË®ºÊòé„Å†ÔºÅÁùÄÂÆü„Å´ÊàêÈï∑„Åó„Å¶„Çã„ÅûÔºÅ",
        "ÊØéÊó•„ÅÆÁ©ç„ÅøÈáç„Å≠„ÅåÂÆü„ÇíÁµê„Çì„Åß„ÇãÔºÅÂêõ„ÅÆÂä™Âäõ„ÅØÁÑ°ÈßÑ„Å´„Å™„Å£„Å¶„Å™„ÅÑÔºÅ",
        "‰ªäÊó•„ÅÆ‰ªï‰∫ã„ÅØÁ¥†Êô¥„Çâ„Åó„Åã„Å£„ÅüÔºÅÂêõ„ÅÆÊàêÈï∑„ÅåÁõÆ„Å´Ë¶ã„Åà„ÇãÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Åß„ÅÆÈÄ≤Ë°å„ÄÅ„Å®„Å¶„ÇÇ‰∏äÊâã„Å†„Å£„ÅüÔºÅ„É™„Éº„ÉÄ„Éº„Ç∑„ÉÉ„Éó„ÅåÂÖâ„Å£„Å¶„ÇãÔºÅ",
        "„Åì„ÅÆ„Çø„Çπ„ÇØÂÆå‰∫Ü„ÅØÂÆåÁíß„Å†ÔºÅÂêõ„ÅÆÈõÜ‰∏≠Âäõ„Å®ÂÆüË°åÂäõ„Åå„Åô„Åî„ÅÑÔºÅ",
        "ÊØéÊó•ÁùÄÂÆü„Å´ÈÄ≤Ê≠©„Åó„Å¶„Çã„Å™ÔºÅÂêõ„ÅÆÊàêÈï∑„ÅØÊ≠¢„Åæ„Çâ„Å™„ÅÑÔºÅ",
        "‰ªäÊó•„ÅÆÊàêÊûú„ÅØÂêõ„ÅÆÂÆüÂäõ„ÅÆË®º„Å†ÔºÅÁ¢∫ÂÆü„Å´„Çπ„ÉÜ„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åó„Å¶„ÇãÔºÅ",
        "„Åì„ÅÆ‰ªï‰∫ã„Å∂„Çä„ÇíË¶ã„Å¶„Çã„Å®„ÄÅÂêõ„ÅÆÂ∞ÜÊù•„ÅåÊ•Ω„Åó„Åø„Å´„Å™„ÇãÔºÅ",
        "„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Åß„ÅÆÊÑèË¶ã„ÄÅ„Å®„Å¶„ÇÇÁöÑÁ¢∫„Å†„Å£„ÅüÔºÅÊàêÈï∑„ÇíÊÑü„Åò„ÇãÔºÅ",
        "‰ªäÊó•„ÇÇÈ†ëÂºµ„Å£„Åü„Å™ÔºÅÂêõ„ÅÆÂä™Âäõ„ÅØÂøÖ„ÅöÂ†±„Çè„Çå„ÇãÔºÅ",
        "„Åì„ÅÆÊàêÊûú„ÅØÂêõ„ÅÆÂÆüÂäõ„ÅÆË®ºÊòé„Å†ÔºÅÁùÄÂÆü„Å´ÊàêÈï∑„Åó„Å¶„Çã„ÅûÔºÅ",
        "ÊØéÊó•„ÅÆÁ©ç„ÅøÈáç„Å≠„ÅåÂÆü„ÇíÁµê„Çì„Åß„ÇãÔºÅÂêõ„ÅÆÂä™Âäõ„ÅØÁÑ°ÈßÑ„Å´„Å™„Å£„Å¶„Å™„ÅÑÔºÅ",
        "‰ªäÊó•„ÅÆ‰ªï‰∫ã„ÅØÁ¥†Êô¥„Çâ„Åó„Åã„Å£„ÅüÔºÅÂêõ„ÅÆÊàêÈï∑„ÅåÁõÆ„Å´Ë¶ã„Åà„ÇãÔºÅ"
      ]
    }
  ]

  // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÁîüÊàêÈñ¢Êï∞Ôºà500ÂÄã„ÄÅÂ∑®Â§ß„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÄÅÁâπÊÆä„Éë„Éº„ÉÜ„Ç£„ÇØ„É´Âê´„ÇÄÔºâ
  const generateParticles = (pattern: PatternType) => {
    const newParticles: Array<{
      id: number
      x: number
      y: number
      vx: number
      vy: number
      rotation: number
      rotationSpeed: number
      color: string
      type: ParticleType
      scale: number
      trail: Array<{x: number, y: number, opacity: number}>
      neon: boolean
    }> = []
    
    const colors = [
      '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8',
      '#FF8E53', '#FF6B9D', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD',
      '#98D8C8', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD'
    ]

    switch (pattern) {
      case 'normal':
        // ÈÄöÂ∏∏„Éë„Çø„Éº„É≥Ôºö500ÂÄã„ÅÆ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´
        for (let i = 0; i < 500; i++) {
          const isGiant = Math.random() < 0.1 // 10%„ÅÆÁ¢∫Áéá„ÅßÂ∑®Â§ß„Éë„Éº„ÉÜ„Ç£„ÇØ„É´
          const isSpecial = Math.random() < 0.15 // 15%„ÅÆÁ¢∫Áéá„ÅßÁâπÊÆä„Éë„Éº„ÉÜ„Ç£„ÇØ„É´
          const hasNeon = Math.random() < 0.2 // 20%„ÅÆÁ¢∫Áéá„Åß„Éç„Ç™„É≥ÂäπÊûú
          
          let randomType: ParticleType
          if (isSpecial) {
            randomType = Math.random() > 0.5 ? 'firework' : 'lightning'
          } else {
            randomType = Math.random() > 0.6 ? 
              (Math.random() > 0.7 ? 'star' : 'trophy') : 
              (Math.random() > 0.5 ? 'heart' : 
               Math.random() > 0.6 ? 'zap' : 
               Math.random() > 0.7 ? 'sparkles' : 
               Math.random() > 0.8 ? 'award' : 'crown')
          }
          
          newParticles.push({
            id: i,
            x: Math.random() * window.innerWidth,
            y: -20,
            vx: (Math.random() - 0.5) * 15,
            vy: Math.random() * 6 + 4,
            rotation: Math.random() * 360,
            rotationSpeed: (Math.random() - 0.5) * 20,
            color: colors[Math.floor(Math.random() * colors.length)],
            type: randomType,
            scale: isGiant ? Math.random() * 2 + 2 : Math.random() * 0.8 + 0.6,
            trail: [],
            neon: hasNeon
          })
        }
        break

      case 'explosion':
        // ÁàÜÁô∫„Éë„Çø„Éº„É≥Ôºö500ÂÄã„ÅÆ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´
        for (let i = 0; i < 500; i++) {
          const angle = (i / 500) * Math.PI * 2
          const speed = Math.random() * 20 + 15
          const isGiant = Math.random() < 0.15
          const hasNeon = Math.random() < 0.25
          
          let randomType: ParticleType
          if (Math.random() < 0.2) {
            randomType = 'firework'
          } else {
            randomType = Math.random() > 0.6 ? 'zap' : 'sparkles'
          }
          
          newParticles.push({
            id: i,
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed,
            rotation: Math.random() * 360,
            rotationSpeed: (Math.random() - 0.5) * 30,
            color: colors[Math.floor(Math.random() * colors.length)],
            type: randomType,
            scale: isGiant ? Math.random() * 2.5 + 2 : Math.random() * 1.2 + 0.8,
            trail: [],
            neon: hasNeon
          })
        }
        break

      default:
        // „Åù„ÅÆ‰ªñ„ÅÆ„Éë„Çø„Éº„É≥„ÇÇÂêåÊßò„Å´500ÂÄã
        for (let i = 0; i < 500; i++) {
          const isGiant = Math.random() < 0.1
          const hasNeon = Math.random() < 0.2
          
          newParticles.push({
            id: i,
            x: Math.random() * window.innerWidth,
            y: -20,
            vx: (Math.random() - 0.5) * 12,
            vy: Math.random() * 4 + 3,
            rotation: Math.random() * 360,
            rotationSpeed: (Math.random() - 0.5) * 15,
            color: colors[Math.floor(Math.random() * colors.length)],
            type: 'star',
            scale: isGiant ? Math.random() * 2 + 1.5 : Math.random() * 0.6 + 0.8,
            trail: [],
            neon: hasNeon
          })
        }
    }
    
    return newParticles
  }

  useEffect(() => {
    if (!isActive) return

    // „Éï„É©„ÉÉ„Ç∑„É•ÂäπÊûú„ÇíË°®Á§∫
    setShowFlash(true)
    setTimeout(() => setShowFlash(false), 300)

    // ÂøúÊè¥ËÄÖ„Å®„Éë„Çø„Éº„É≥„ÇíÈÅ∏Êäû
    let chosenSupporter: Supporter
    if (selectedSupporter) {
      chosenSupporter = Math.random() < 0.7 ? selectedSupporter : supporters[Math.floor(Math.random() * supporters.length)]
    } else {
      chosenSupporter = supporters[Math.floor(Math.random() * supporters.length)]
    }
    
    const randomMessage = chosenSupporter.messages[Math.floor(Math.random() * chosenSupporter.messages.length)]
    const patterns: PatternType[] = ['normal', 'spiral', 'explosion', 'rain', 'starfield']
    const randomPattern = patterns[Math.floor(Math.random() * patterns.length)]
    
    setCurrentSupporter(chosenSupporter)
    setCurrentMessage(randomMessage)
    setCurrentPattern(randomPattern)

    // 500ÂÄã„ÅÆ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÇíÁîüÊàê
    const newParticles = generateParticles(randomPattern)
    setParticles(newParticles)

    // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÊôÇÈñì„ÇíÂª∂Èï∑Ôºà6ÁßíÔºâ
    const timer = setTimeout(() => {
      onComplete()
    }, 6000)

    return () => clearTimeout(timer)
  }, [isActive, onComplete, selectedSupporter])

  useEffect(() => {
    if (!isActive || particles.length === 0) return

    const animate = () => {
      setParticles(prev => 
        prev.map(particle => {
          // ËªåË∑°„ÇíÊõ¥Êñ∞
          const newTrail = [...particle.trail, {x: particle.x, y: particle.y, opacity: 1}]
          if (newTrail.length > 10) newTrail.shift()
          
          // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÅÆÂãï„Åç„ÇíÊõ¥Êñ∞
          let newVx = particle.vx
          let newVy = particle.vy
          
          // „Éë„Çø„Éº„É≥Âà•„ÅÆÁâπÂà•„Å™Âãï„Åç
          switch (currentPattern) {
            case 'explosion':
              newVx = particle.vx * 0.95
              newVy = particle.vy * 0.95
              break
            case 'rain':
              newVy = particle.vy + 0.3
              break
          }
          
          return {
            ...particle,
            x: particle.x + newVx,
            y: particle.y + newVy,
            rotation: particle.rotation + particle.rotationSpeed,
            vx: newVx,
            vy: newVy,
            trail: newTrail.map(t => ({...t, opacity: t.opacity * 0.9}))
          }
        })
      )
    }

    const interval = setInterval(animate, 16)
    return () => clearInterval(interval)
  }, [isActive, particles, currentPattern])

  if (!isActive) return null

  return (
    <div className="fixed inset-0 pointer-events-none z-50">
      {/* „Éï„É©„ÉÉ„Ç∑„É•ÂäπÊûú */}
      {showFlash && (
        <div className="absolute inset-0 bg-white animate-pulse" style={{animationDuration: '0.3s'}} />
      )}

      {/* „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ */}
      {particles.map(particle => (
        <div key={particle.id}>
          {/* ËªåË∑°ÂäπÊûú */}
          {particle.trail.map((trail, index) => (
            <div
              key={`${particle.id}-trail-${index}`}
              className="absolute w-1 h-1 rounded-full"
              style={{
                left: trail.x,
                top: trail.y,
                backgroundColor: particle.color,
                opacity: trail.opacity * 0.6,
                transform: `scale(${particle.scale * 0.3})`
              }}
            />
          ))}
          
          {/* „É°„Ç§„É≥„Éë„Éº„ÉÜ„Ç£„ÇØ„É´ */}
          <div
            className="absolute"
            style={{
              left: particle.x,
              top: particle.y,
              transform: `rotate(${particle.rotation}deg) scale(${particle.scale})`,
              filter: particle.neon ? 'drop-shadow(0 0 10px currentColor) drop-shadow(0 0 20px currentColor)' : 'none'
            }}
          >
            {particle.type === 'confetti' && (
              <div
                className="w-3 h-3"
                style={{ backgroundColor: particle.color }}
              />
            )}
            {particle.type === 'star' && (
              <Star className="w-4 h-4 text-yellow-400 fill-current" />
            )}
            {particle.type === 'trophy' && (
              <Trophy className="w-4 h-4 text-yellow-500 fill-current" />
            )}
            {particle.type === 'heart' && (
              <Heart className="w-4 h-4 text-pink-500 fill-current" />
            )}
            {particle.type === 'zap' && (
              <Zap className="w-4 h-4 text-yellow-500 fill-current" />
            )}
            {particle.type === 'sparkles' && (
              <Sparkles className="w-4 h-4 text-purple-500 fill-current" />
            )}
            {particle.type === 'award' && (
              <Award className="w-4 h-4 text-blue-500 fill-current" />
            )}
            {particle.type === 'crown' && (
              <Crown className="w-4 h-4 text-yellow-600 fill-current" />
            )}
            {particle.type === 'firework' && (
              <div className="w-6 h-6 text-orange-500 text-4xl">üéÜ</div>
            )}
            {particle.type === 'lightning' && (
              <div className="w-6 h-6 text-yellow-300 text-4xl">‚ö°</div>
            )}
          </div>
        </div>
      ))}

      {/* ‰∏≠Â§Æ„ÅÆÂÆå‰∫Ü„É°„ÉÉ„Çª„Éº„Ç∏ */}
      <div className="absolute inset-0 flex items-center justify-center">
        <div className="bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-3xl shadow-2xl p-10 text-center transform animate-bounce border-4 border-gradient-to-r from-green-400 to-blue-500">
          {currentSupporter && (
            <div className="flex items-center justify-center mb-4">
              <div className="text-6xl mr-3">{currentSupporter.avatar}</div>
              <div className="text-left">
                <div className="text-lg font-medium text-gray-700">
                  {currentSupporter.customName || currentSupporter.name}„Çà„Çä
                </div>
                <div className="text-sm text-gray-500">ÂøúÊè¥„É°„ÉÉ„Çª„Éº„Ç∏</div>
              </div>
            </div>
          )}
          
          <div className="flex items-center justify-center w-24 h-24 rounded-full mx-auto mb-6 animate-pulse bg-gradient-to-br from-green-400 to-blue-500">
            <CheckCircle className="w-14 h-14 text-white" />
          </div>
          
          <h2 className="text-3xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent mb-3">
            „Çø„Çπ„ÇØÂÆå‰∫ÜÔºÅ
          </h2>
          
          <div className="bg-white/80 rounded-xl p-4 mb-4 border-2 border-gray-200">
            <p className="text-xl text-gray-700 font-medium">{currentMessage}</p>
          </div>
          
          <p className="text-lg text-gray-600 mb-6">„ÅäÁñ≤„Çå„Åï„Åæ„Åß„Åó„ÅüÔºÅ</p>
          
          <div className="flex items-center justify-center gap-3 text-3xl animate-pulse">
            <span>üéâ</span><span>‚ú®</span><span>üéä</span><span>üåü</span><span>üí´</span>
          </div>
        </div>
      </div>

      {/* ËÉåÊôØ„ÅÆ„Ç™„Éº„Éê„Éº„É¨„Ç§ */}
      <div className="absolute inset-0 animate-pulse bg-gradient-to-b from-transparent via-blue-50/40 to-purple-50/40" />
      
      {/* Ë£ÖÈ£æË¶ÅÁ¥† */}
      <div className="absolute top-10 left-10 text-6xl animate-bounce">üéä</div>
      <div className="absolute top-20 right-20 text-5xl animate-bounce delay-100">‚ú®</div>
      <div className="absolute bottom-20 left-20 text-5xl animate-bounce delay-200">üåü</div>
      <div className="absolute bottom-10 right-10 text-6xl animate-bounce delay-300">üéâ</div>
    </div>
  )
}
